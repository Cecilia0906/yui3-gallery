<div id="demo" class="yui3-skin-sam">
  <div class="thumbs">
    <img src="http://farm8.staticflickr.com/7277/7688294254_501e8fcfcb.jpg" data-height="327" data-width="500">
    <img src="http://farm9.staticflickr.com/8155/7669226050_a06b0c63ab.jpg" data-height="500" data-width="500">
    <img src="http://farm9.staticflickr.com/8009/7697217764_d3a8fe09fe.jpg" data-height="333" data-width="500">
    <img src="http://farm9.staticflickr.com/8293/7663355854_cd01985e1e.jpg" data-height="332" data-width="500">
    <img src="http://farm8.staticflickr.com/7280/7692271222_9bf2febff9.jpg" data-height="500" data-width="500">
  </div>
</div>

<script type="text/javascript">
YUI().use({{{useParams}}}, function(Y) {
    
  var image = Y.one('.thumbs img');

  var nativeSupport = "naturalHeight" in image.getDOMNode();

  function AutoSizePlugin(config) {
    var host = this._host = config.host;

    this._handle = host.after(['render', 'sourceChange'], this.syncSize, this);
  }
  AutoSizePlugin.NS = 'autosize';
  AutoSizePlugin.prototype.syncSize = function () {
    if (nativeSupport) {
      this._syncNative();
    } else {
      this._syncFallback();
    }
    return this;
  };
  AutoSizePlugin.prototype._syncNative = function() {
    var host = this._host,
        node = host.get('contentBox').getDOMNode();
    
    host.setAttrs({
      width: node.naturalWidth,
      height: node.naturalHeight
    });
  };
  AutoSizePlugin.prototype._syncFallback = function () {
    var host = this._host,
        img = new Image();

    img.onload = function () {
      host.setAttrs({
        width: img.width,
        height: img.height
      });
    };
    img.src = host.get('source');
  };
  AutoSizePlugin.prototype.destroy = function () {
    this._handle.detach();
    this._handle = null;
    this._host = null;
  };
  
  var imagecropper = new Y.ImageCropper({
    source: image.get('src'),
    initialXY: [0, 0]
  });
  imagecropper.plug(AutoSizePlugin);
  imagecropper.render('#demo');
  
  Y.one('.thumbs').delegate('click', function (e) {
    imagecropper.set('source', e.target.get('src')).reset();
  }, 'img');
    
});
</script>
