YUI.add("gallery-deferred",function(a){var d=a.Lang,i=a.Array,j=Array.prototype,c=j.slice,e=j.push;i._spread=function(k){k=d.isArray(k)?k:[k];var l=0;while(l<k.length){if(d.isArray(k[l])){j.splice.apply(k,[l,1].concat(k[l]));}else{if(!d.isValue(k[l])){k.splice(l,1);}else{l++;}}}return k;};function g(){this._done=[];this._fail=[];this.resolved=false;this.rejected=false;}g.prototype={constructor:g,then:function(l,k){l=i._spread(l);k=i._spread(k);if(this.resolved){this._notify(l,this._args||[],this);}else{if(!this.rejected){e.apply(this._done,l);}}if(this.rejected){this._notify(k,this._args||[],this);}else{if(!this.resolved){e.apply(this._fail,k);}}return this;},done:function(){return this.then(c.call(arguments));},fail:function(){return this.then(null,c.call(arguments));},always:function(){var k=c.call(arguments);return this.then(k,k);},resolve:function(){return this.resolveWith(this,c.call(arguments));},reject:function(){return this.rejectWith(this,c.call(arguments));},resolveWith:function(l,k){this.resolved=true;this._args=k;return this._notify(this._done,k,l);},rejectWith:function(l,k){this.rejected=true;this._args=k;return this._notify(this._fail,k,l);},_notify:function(o,k,m){for(var l=0,n=o.length;l<n;l++){o[l].apply(m,k);}return this;},defer:function(m,k){var l=new this.constructor();this.then(a.bind(m,k||this,l));return l;}};a.Promise=g;function h(){this._fail=[];}h.prototype={then:function(l,k){var m=this._next;if(l||k){l=i._spread(l);if(m){i.each(l,function(n,o){if(n.end){l[o]=function(){n.end();};}});m.then(l,k);}else{l=i.filter(l,function(n){return !n.end;});this._notify(l);}}return this;},_switchPromise:function(k){this._current=k;},defer:function(m,l){l=l||this;var n=new g(),k=a.bind(this._switchPromise,this,n);if(m){m=a.bind(m,l,n);n.fail(a.bind(this._notifyFailure,this));if(this._next){this._next.then([m,k],k);}else{this._starter=m;this._current=n;}}this._next=n;return this;},end:function(l,k){this.then(l);this._fail.push.apply(this._fail,i._spread(k));return this.run();},run:function(){this._starter&&this._starter();return this;},resolveWith:function(l,k){var m=this._current;if(m){m.resolve.apply(l,k);}return this;},rejectWith:function(l,k){var m=this._current;if(m){m.reject.apply(l,k);}return this;},isResolved:function(){return !!this._current.resolved;},isRejected:function(){return !!this._current.rejected;},_notifyFailure:function(){var k=arguments;i.each(this._fail,function(l){l.apply(this,k);},this);return this;}};h.PROMISE_METHODS=["done","fail","always","resolve","reject","_notify"];i.each(h.PROMISE_METHODS,function(k){h.prototype[k]=g.prototype[k];});a.Deferred=h;function b(k){b.superclass.constructor.apply(this,arguments);this.host=k.host;}a.extend(b,h,null,{NS:"deferred",importMethod:function(k){b.prototype[k]=function(){if(this.host[k]){var l=c.call(arguments),m;if(d.isFunction(l[l.length-1])){m=l.pop();}return this.defer(function(n){this.host[k].apply(this.host,l.concat([a.bind(n.resolve,n)]));}).done(m);}else{if(a.instanceOf(this.host,a.NodeList)&&k=="load"){a.error("NodeList doesn't have a "+k+"() method");}else{a.error("Missing required module for "+k);}}return this;};}});i.each(["hide","load","show","transition"],b.importMethod);if(a.Node){a.Node.Deferred=b;}a.defer=function(m,l){var k=new a.Deferred();return k.defer(m,l);};a.when=function(){var n=i._spread(c.call(arguments)),l=[],m=0,k=0,o=0;return a.defer(function(s){function r(){if(o>0){s.rejectWith(s,l);}else{s.resolveWith(s,l);}}function q(){l.push(c.call(arguments));k++;if(k+o==n.length){r();}}function p(){l.push(c.call(arguments));o++;if(k+o==n.length){r();}}while(m<n.length){n[m].end(q,p);m++;}});};function f(){f.superclass.constructor.apply(this,arguments);}a.extend(f,h,{abort:function(){if(this._request&&this._request.abort){this._request.abort();}return this.reject();}},{addMethod:function(k,l){f.prototype[k]=function(p,q){var o=(!d.isObject(q)||d.isFunction(q))?{}:q,m=o.on||(o.on={}),r=m.success,n=m.failure;if(d.isFunction(q)){r=q;}return this.defer(function(s){m.success=a.bind(s.resolve,s);m.failure=a.bind(s.reject,s);this._request=l(p,o);}).then(r,n);};}});a.Transaction=f;i.each(["io","jsonp"],function(k){if(a[k]){f.addMethod(k,a[k]);a[k].defer=function(){var l=new a.Transaction();l.resolved=true;return l[k].apply(l,arguments);};}});},"@VERSION@",{optional:["io","node","node-load","transition","plugin"],requires:["array-extras"]});