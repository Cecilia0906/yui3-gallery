YUI.add("gallery-imagecropper",function(b){var f=b.Lang,d=b.ClassNameManager.getClassName,h="imagecropper",c="resize",g="mask",a="knob",e={cropMask:d(h,g),resizeKnob:d(h,c,a),resizeMask:d(h,c,g)},i=b.ImageCropper=b.Base.create("imagecropper",b.Widget,[],{CONTENT_TEMPLATE:"<img/>",_defCropMaskValueFn:function(){return b.Node.create(i.CROP_MASK_TEMPLATE);},_defResizeKnobValueFn:function(){return b.Node.create(i.RESIZE_KNOB_TEMPLATE);},_defResizeMaskValueFn:function(){return b.Node.create(i.RESIZE_MASK_TEMPLATE);},_renderCropMask:function(j){var k=this.get("cropMask");if(!k.inDoc()){j.append(k);}},_renderResizeKnob:function(j){var k=this.get("resizeKnob");if(!k.inDoc()){j.append(k);}},_renderResizeMask:function(){var j=this.get("resizeMask");if(!j.inDoc()){this.get("resizeKnob").append(j);}j.setStyle("backgroundImage","url("+this.get("src")+")");},_handleSrcChange:function(j){this.get("contentBox").set("src",j.newVal);this.get("cropResizeMask").setStyle("backgroundImage","url("+j.newVal+")");},_syncResizeKnob:function(){var j=this.get("initialXY");this.get("resizeKnob").setStyles({left:j[0],top:j[1],width:this.get("initWidth"),height:this.get("initHeight")});},_syncResizeMask:function(){var j=this.get("resizeKnob");this.get("resizeMask").setStyle("backgroundPosition",(-j.get("offsetLeft"))+"px "+(-j.get("offsetTop"))+"px");},_syncCropMask:function(j){this.get("cropMask").setStyles({width:j.get("width"),height:j.get("height")});},_syncResizeAttr:function(j){if(this._resize){this._resize.con.set(j.attrName,j.newVal);}},initializer:function(){this.set("initialXY",this.get("initialXY")||[10,10]);this.set("initWidth",this.get("initWidth"));this.set("initHeight",this.get("initHeight"));this.after("srcChange",this._handleSrcChange);this.after("minWidthChange",this._syncResizeAttr);this.after("minHeightChange",this._syncResizeAttr);this.after("preserveRatioChange",this._syncResizeAttr);},renderUI:function(){var j=this.get("boundingBox");this._renderCropMask(j);this._renderResizeKnob(j);this._renderResizeMask();},bindUI:function(){var k=this.get("contentBox"),j=this.get("resizeKnob"),m,n,l=b.bind(this._syncResizeMask,this);m=this._resize=new b.Resize({node:j,on:{"resize:resize":l}});m.plug(b.Plugin.ResizeConstrained,{constrain:k,minHeight:this.get("minHeight"),minWidth:this.get("minWidth"),preserveRatio:this.get("preserveRatio")});n=this._drag=new b.DD.Drag({node:j,handles:[this.get("resizeMask")],on:{"drag:drag":l}});n.plug(b.Plugin.DDConstrained,{constrain2node:k});},syncUI:function(){var j=this.get("contentBox").set("src",this.get("src"));this._syncCropMask(j);this._syncResizeKnob();this._syncResizeMask();},destructor:function(){this._resize.destroy();this._drag.destroy();}},{CROP_MASK_TEMPLATE:'<div class="'+e.cropMask+'"></div>',RESIZE_KNOB_TEMPLATE:'<div class="'+e.resizeKnob+'"></div>',RESIZE_MASK_TEMPLATE:'<div class="'+e.resizeMask+'"></div>',HTML_PARSER:{src:function(j){return j.get("src");},cropMask:"."+e.cropMask,resizeKnob:"."+e.resizeKnob,resizeMask:"."+e.resizeMask},ATTRS:{src:{value:""},resizeMask:{setter:function(j){j=b.one(j);if(j){j.addClass(e.resizeMask);}return j;},valueFn:"_defResizeMaskValueFn"},resizeKnob:{setter:function(j){j=b.one(j);if(j){j.addClass(e.resizeKnob);}return j;},valueFn:"_defResizeKnobValueFn"},cropMask:{setter:function(j){j=b.one(j);if(j){j.addClass(e.cropMask);}return j;},valueFn:"_defCropMaskValueFn"},initialXY:{validator:f.isArray},keyTick:{value:1,validator:f.isNumber},shiftKeyTick:{value:10,validator:f.isNumber},useKeys:{value:true,validator:f.isBoolean},status:{value:true,validator:f.isBoolean},minHeight:{value:50,validator:f.isNumber},minWidth:{value:50,validator:f.isNumber},preserveRatio:{value:false,validator:f.isBoolean},initHeight:{value:0,validator:f.isNumber,setter:function(k){var j=this.get("minHeight");return k<j?j:k;}},initWidth:{value:0,validator:f.isNumber,setter:function(k){var j=this.get("minWidth");return k<j?j:k;}}}});},"@VERSION@",{requires:["widget","resize"]});