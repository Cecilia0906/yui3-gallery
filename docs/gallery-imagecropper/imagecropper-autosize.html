<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Example: Writing an ImageCropper AutoSize plugin</title>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Maven+Pro:400,700">
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.4.1/build/cssgrids/grids-min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <script src="http://yui.yahooapis.com/3.6.0/build/yui/yui-min.js"></script>
    
</head>
<body>

<div id="doc">
    <h1>Example: Writing an ImageCropper AutoSize plugin</h1>

    

    <div class="yui3-g">
        <div class="yui3-u-3-4">
            <div id="main">
                <div class="content"><script>
YUI_config = {
  filter: 'raw',
  modules: {
    'gallery-imagecropper-styles': {
      type: 'css',
      fullpath: '/yui3-gallery/build/gallery-imagecropper/assets/skins/sam/gallery-imagecropper.css'
    },
    'gallery-imagecropper': {
      fullpath: '/yui3-gallery/build/gallery-imagecropper/gallery-imagecropper.js',
      requires: ['widget', 'dd-drag', 'dd-constrain', 'resize-base', 'resize-constrain', 'gallery-imagecropper-styles']
    }
  }
};
</script>
<style>
.thumbs img {
    max-width: 150px;
    border: 4px solid transparent;
    cursor: pointer;
}
.thumbs img:hover {
    border-color: blue;
}
</style>

<div class="intro">
<p>
This example expands on the <a href="imagecropper-gallery.html">Cropping images from thumbnails</a> example and shows how to make an AutoSize plugin automatically figures out the size of the ImageCropper based on the image being cropped. It uses the <a href="https://developer.mozilla.org/en-US/docs/DOM/HTMLImageElement">HTML5 Image API</a> and falls back to a less optimal strategy in older browsers.
</p>
</div>

<div class="example yui3-skin-sam">
    <div id="demo" class="yui3-skin-sam">
  <div class="thumbs">
    <img src="http://farm8.staticflickr.com/7277/7688294254_501e8fcfcb.jpg" data-height="327" data-width="500">
    <img src="http://farm9.staticflickr.com/8155/7669226050_a06b0c63ab.jpg" data-height="500" data-width="500">
    <img src="http://farm9.staticflickr.com/8009/7697217764_d3a8fe09fe.jpg" data-height="333" data-width="500">
    <img src="http://farm9.staticflickr.com/8293/7663355854_cd01985e1e.jpg" data-height="332" data-width="500">
    <img src="http://farm8.staticflickr.com/7280/7692271222_9bf2febff9.jpg" data-height="500" data-width="500">
  </div>
</div>

<script type="text/javascript">
YUI().use('gallery-imagecropper', function(Y) {
    
  var image = Y.one('.thumbs img');

  var nativeSupport = "naturalHeight" in image.getDOMNode();

  function AutoSizePlugin(config) {
    var host = this._host = config.host;

    this._handle = host.after(['render', 'sourceChange'], this.syncSize, this);
  }
  AutoSizePlugin.NS = 'autosize';
  AutoSizePlugin.prototype.syncSize = function () {
    if (nativeSupport) {
      this._syncNative();
    } else {
      this._syncFallback();
    }
    return this;
  };
  AutoSizePlugin.prototype._syncNative = function() {
    var host = this._host,
        node = host.get('contentBox').getDOMNode();
    
    host.setAttrs({
      width: node.naturalWidth,
      height: node.naturalHeight
    });
  };
  AutoSizePlugin.prototype._syncFallback = function () {
    var host = this._host,
        img = new Image();

    img.onload = function () {
      host.setAttrs({
        width: img.width,
        height: img.height
      });
    };
    img.src = host.get('source');
  };
  AutoSizePlugin.prototype.destroy = function () {
    this._handle.detach();
    this._handle = null;
    this._host = null;
  };
  
  var imagecropper = new Y.ImageCropper({
    source: image.get('src'),
    initialXY: [0, 0]
  });
  imagecropper.plug(AutoSizePlugin);
  imagecropper.render('#demo');
  
  Y.one('.thumbs').delegate('click', function (e) {
    imagecropper.set('source', e.target.get('src')).reset();
  }, 'img');
    
});
</script>

</div>

<h2>Complete Example Source</h2>

<pre class="code prettyprint">&lt;div id=&quot;demo&quot; class=&quot;yui3-skin-sam&quot;&gt;
  &lt;div class=&quot;thumbs&quot;&gt;
    &lt;img src=&quot;http:&#x2F;&#x2F;farm8.staticflickr.com&#x2F;7277&#x2F;7688294254_501e8fcfcb.jpg&quot; data-height=&quot;327&quot; data-width=&quot;500&quot;&gt;
    &lt;img src=&quot;http:&#x2F;&#x2F;farm9.staticflickr.com&#x2F;8155&#x2F;7669226050_a06b0c63ab.jpg&quot; data-height=&quot;500&quot; data-width=&quot;500&quot;&gt;
    &lt;img src=&quot;http:&#x2F;&#x2F;farm9.staticflickr.com&#x2F;8009&#x2F;7697217764_d3a8fe09fe.jpg&quot; data-height=&quot;333&quot; data-width=&quot;500&quot;&gt;
    &lt;img src=&quot;http:&#x2F;&#x2F;farm9.staticflickr.com&#x2F;8293&#x2F;7663355854_cd01985e1e.jpg&quot; data-height=&quot;332&quot; data-width=&quot;500&quot;&gt;
    &lt;img src=&quot;http:&#x2F;&#x2F;farm8.staticflickr.com&#x2F;7280&#x2F;7692271222_9bf2febff9.jpg&quot; data-height=&quot;500&quot; data-width=&quot;500&quot;&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;div&gt;

&lt;script type=&quot;text&#x2F;javascript&quot;&gt;
YUI().use(&#x27;gallery-imagecropper&#x27;, function(Y) {
    
  var image = Y.one(&#x27;.thumbs img&#x27;);

  var nativeSupport = &quot;naturalHeight&quot; in image.getDOMNode();

  function AutoSizePlugin(config) {
    var host = this._host = config.host;

    this._handle = host.after([&#x27;render&#x27;, &#x27;sourceChange&#x27;], this.syncSize, this);
  }
  AutoSizePlugin.NS = &#x27;autosize&#x27;;
  AutoSizePlugin.prototype.syncSize = function () {
    if (nativeSupport) {
      this._syncNative();
    } else {
      this._syncFallback();
    }
    return this;
  };
  AutoSizePlugin.prototype._syncNative = function() {
    var host = this._host,
        node = host.get(&#x27;contentBox&#x27;).getDOMNode();
    
    host.setAttrs({
      width: node.naturalWidth,
      height: node.naturalHeight
    });
  };
  AutoSizePlugin.prototype._syncFallback = function () {
    var host = this._host,
        img = new Image();

    img.onload = function () {
      host.setAttrs({
        width: img.width,
        height: img.height
      });
    };
    img.src = host.get(&#x27;source&#x27;);
  };
  AutoSizePlugin.prototype.destroy = function () {
    this._handle.detach();
    this._handle = null;
    this._host = null;
  };
  
  var imagecropper = new Y.ImageCropper({
    source: image.get(&#x27;src&#x27;),
    initialXY: [0, 0]
  });
  imagecropper.plug(AutoSizePlugin);
  imagecropper.render(&#x27;#demo&#x27;);
  
  Y.one(&#x27;.thumbs&#x27;).delegate(&#x27;click&#x27;, function (e) {
    imagecropper.set(&#x27;source&#x27;, e.target.get(&#x27;src&#x27;)).reset();
  }, &#x27;img&#x27;);
    
});
&lt;&#x2F;script&gt;</pre>

</div>
            </div>
        </div>

        <div class="yui3-u-1-4">
            <div class="sidebar">
                

                
                    <div class="sidebox">
                        <div class="hd">
                            <h2 class="no-toc">Examples</h2>
                        </div>

                        <div class="bd">
                            <ul class="examples">
                                
                                    
                                        <li data-description="This example shows how to create an ImageCropper from markup">
                                            <a href="imagecropper-basic.html">Augmenting an image with an ImageCropper</a>
                                        </li>
                                    
                                
                                    
                                        <li data-description="This example shows how to use ImageCropper events to show a preview of the image being cropped">
                                            <a href="imagecropper-events.html">Using the crop event</a>
                                        </li>
                                    
                                
                                    
                                        <li data-description="This example shows how to select the image to crop from a list of thumbnails">
                                            <a href="imagecropper-gallery.html">Cropping images from thumbnails</a>
                                        </li>
                                    
                                
                                    
                                        <li data-description="This example shows how to develop a Plugin for ImageCropper that resizes the widget automatically based on the size of its image">
                                            <a href="imagecropper-autosize.html">Writing an ImageCropper AutoSize plugin</a>
                                        </li>
                                    
                                
                            </ul>
                        </div>
                    </div>
                

                
            </div>
        </div>
    </div>
</div>

<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>


</body>
</html>
