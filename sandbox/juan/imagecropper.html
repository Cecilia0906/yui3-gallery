<!DOCTYPE html> 
<html> 
<head> 
	<title>ImageCropper test</title> 
	<link rel="stylesheet" href="http://github.com/juandopazo/yui3-gallery/raw/imagecropper/src/gallery-imagecropper/assets/gallery-imagecropper-core.css">
	<style>
		.yui3-imagecropper {
			background: #666;
		}
	</style> 
</head> 
<body>
	<div style="position: absolute; left: 550px; top: 10px;">
		<div id="result"></div>
		<div id="test"></div>
	</div>
	<script src="http://yui.yahooapis.com/combo?3.4.0pr1/build/yui/yui-min.js&3.4.0pr1/build/loader/loader-min.js"></script> 
	<script> 
YUI({
	gallery: 'gallery-2011.01.18-21-05',
	modules: {
		'gallery-imagecropper': {
			fullpath: 'http://juandopazo.github.com/yui3-gallery/build/gallery-imagecropper/gallery-imagecropper.js',
			requires: ['resize', 'widget', 'gallery-event-arrow']
		}
	}
}).use('yql', 'gallery-imagecropper', function (Y) {
	
	Y.random = function (limit) {
		return Math.floor(Math.random() * limit);
	};
	
	Y.Node.addMethod('setBackgroundXY', function (node, xy) {
		xy = xy || [0, 0];
		Y.Array.each(xy, function (val, i) {
			if (Y.Lang.isNumber(val)) {
				xy[i] += 'px';
			}
		});
		this.setStyles({
			backgroundPosition: xy.join(' '),
			backgroundPositionX: xy[0],
			backgroundPositionY: xy[1]
		});
	});
	
	Y.YQL('select width,height,source from flickr.photos.sizes where photo_id in (select id from flickr.photos.interestingness limit 10) and label = "Medium"', function (response) {
		
		var photo = response.query.results.size[Y.random(10)],
			test = Y.one('#test'),
			result = Y.one('#result'),
		
			imagecropper = new Y.ImageCropper(photo).render(),
			
			coords = imagecropper.getCropCoords();
		
		imagecropper.on('crop:crop', function (e) {
			
			test.setContent(e.left + 'x' + e.top + ' ' + e.width + 'x' + e.height);
			
			result.setBackgroundXY([-e.left, -e.top]).setStyles({
				width: e.width,
				height: e.height
			});
			
		});
		
		result.setBackgroundXY([-coords.left, -coords.top]).setStyles({
			backgroundImage: 'url(' + coords.image + ')',
			width: coords.width,
			height: coords.height
		});
		
	});
	
});
	</script>
</body> 
</html>